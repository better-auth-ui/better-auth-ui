{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "user-button",
  "title": "User Button",
  "description": "Renders a user button with dropdown menu showing user info and sign out option.",
  "dependencies": [
    "@better-auth-ui/react@*",
    "better-auth",
    "lucide-react"
  ],
  "registryDependencies": [
    "avatar",
    "button",
    "dropdown-menu",
    "skeleton"
  ],
  "files": [
    {
      "path": "src/components/user/user-button.tsx",
      "content": "\"use client\"\n\nimport {\n  type AnyAuthConfig,\n  useListDeviceSessions,\n  useSetActiveSession\n} from \"@better-auth-ui/react\"\nimport {\n  Check,\n  ChevronsUpDown,\n  CirclePlus,\n  LogIn,\n  LogOut,\n  Settings,\n  UserPlus2,\n  UsersRound\n} from \"lucide-react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuTrigger\n} from \"@/components/ui/dropdown-menu\"\nimport { useAuth } from \"@/hooks/auth/use-auth\"\nimport { useSession } from \"@/hooks/auth/use-session\"\nimport { cn } from \"@/lib/utils\"\nimport { UserAvatar } from \"./user-avatar\"\nimport { UserView } from \"./user-view\"\n\nexport type UserButtonProps = AnyAuthConfig & {\n  className?: string\n  align?: \"center\" | \"end\" | \"start\" | undefined\n  sideOffset?: number\n  size?: \"default\" | \"icon\"\n  variant?:\n    | \"default\"\n    | \"destructive\"\n    | \"ghost\"\n    | \"link\"\n    | \"outline\"\n    | \"secondary\"\n}\n\n/**\n * Renders a user button with dropdown menu showing user info and sign out option.\n */\nexport function UserButton({\n  className,\n  align,\n  sideOffset,\n  size = \"default\",\n  variant = \"ghost\",\n  ...config\n}: UserButtonProps) {\n  const context = useAuth(config)\n  const { basePaths, viewPaths, localization, multiSession, Link } = context\n\n  const { data: sessionData, isPending: sessionPending } = useSession(context)\n  const { data: deviceSessions } = useListDeviceSessions(context)\n  const { settingActiveSession, setActiveSession } =\n    useSetActiveSession(context)\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild={size === \"default\"}>\n        {size === \"icon\" ? (\n          <UserAvatar {...config} />\n        ) : (\n          <Button\n            variant={variant}\n            className={cn(\"h-auto font-normal\", className)}\n          >\n            {sessionData || sessionPending || settingActiveSession ? (\n              <UserView\n                {...config}\n                isPending={sessionPending || !!settingActiveSession}\n              />\n            ) : (\n              <>\n                <UserAvatar {...config} />\n\n                <div className=\"grid flex-1 text-left text-sm leading-tight\">\n                  {localization.auth.account}\n                </div>\n              </>\n            )}\n\n            <ChevronsUpDown className=\"ml-auto\" />\n          </Button>\n        )}\n      </DropdownMenuTrigger>\n\n      <DropdownMenuContent\n        className=\"w-[--radix-dropdown-menu-trigger-width] min-w-40 md:min-w-56 max-w-[48svw]\"\n        sideOffset={sideOffset}\n        align={align}\n        onCloseAutoFocus={(e) => e.preventDefault()}\n      >\n        {sessionData && (\n          <>\n            <DropdownMenuLabel className=\"text-sm font-normal\">\n              <UserView {...config} />\n            </DropdownMenuLabel>\n\n            <DropdownMenuSeparator />\n          </>\n        )}\n\n        {sessionData ? (\n          <>\n            <DropdownMenuItem asChild>\n              <Link\n                href={`${basePaths.settings}/${viewPaths.settings.account}`}\n              >\n                <Settings />\n\n                {localization.settings.settings}\n              </Link>\n            </DropdownMenuItem>\n\n            {multiSession && (\n              <DropdownMenuSub>\n                <DropdownMenuSubTrigger>\n                  <UsersRound />\n\n                  {localization.auth.switchAccount}\n                </DropdownMenuSubTrigger>\n\n                <DropdownMenuSubContent className=\"min-w-40 md:min-w-56 max-w-[48svw]\">\n                  <DropdownMenuItem>\n                    <UserView {...config} />\n\n                    <Check className=\"ml-auto\" />\n                  </DropdownMenuItem>\n\n                  {deviceSessions\n                    ?.filter(\n                      (deviceSession) =>\n                        deviceSession.session.id !== sessionData?.session.id\n                    )\n                    .map((deviceSession) => (\n                      <DropdownMenuItem\n                        key={deviceSession.session.id}\n                        onSelect={() =>\n                          setActiveSession(deviceSession.session.token)\n                        }\n                      >\n                        <UserView {...config} user={deviceSession.user} />\n                      </DropdownMenuItem>\n                    ))}\n\n                  <DropdownMenuSeparator />\n\n                  <DropdownMenuItem asChild>\n                    <Link href={`${basePaths.auth}/${viewPaths.auth.signIn}`}>\n                      <CirclePlus />\n\n                      {localization.auth.addAccount}\n                    </Link>\n                  </DropdownMenuItem>\n                </DropdownMenuSubContent>\n              </DropdownMenuSub>\n            )}\n\n            <DropdownMenuSeparator />\n\n            <DropdownMenuItem asChild>\n              <Link href={`${basePaths.auth}/${viewPaths.auth.signOut}`}>\n                <LogOut />\n\n                {localization.auth.signOut}\n              </Link>\n            </DropdownMenuItem>\n          </>\n        ) : (\n          <>\n            <DropdownMenuItem asChild>\n              <Link href={`${basePaths.auth}/${viewPaths.auth.signIn}`}>\n                <LogIn />\n\n                {localization.auth.signIn}\n              </Link>\n            </DropdownMenuItem>\n\n            <DropdownMenuItem asChild>\n              <Link href={`${basePaths.auth}/${viewPaths.auth.signUp}`}>\n                <UserPlus2 />\n\n                {localization.auth.signUp}\n              </Link>\n            </DropdownMenuItem>\n          </>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/user/user-avatar.tsx",
      "content": "\"use client\"\n\nimport type { AnyAuthConfig } from \"@better-auth-ui/react\"\nimport type { User } from \"better-auth\"\nimport { User2 } from \"lucide-react\"\nimport type { ReactNode } from \"react\"\n\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport { useAuth } from \"@/hooks/auth/use-auth\"\nimport { useSession } from \"@/hooks/auth/use-session\"\nimport { cn } from \"@/lib/utils\"\n\nexport type UserAvatarProps = AnyAuthConfig & {\n  className?: string\n  fallback?: ReactNode\n  isPending?: boolean\n  user?: User & { username?: string | null; displayUsername?: string | null }\n}\n\n/**\n * Display a user's avatar using session information or an explicit user prop.\n *\n * Renders a circular avatar that shows the user's image when available, a fallback node if provided, or the user's first two initials; while the session is loading (or when `isPending` is true) and no `user` prop is supplied, renders a skeleton placeholder.\n *\n * @param className - Additional CSS classes applied to the avatar container\n * @param user - Optional user object to display instead of the session user\n * @param isPending - When true, treat the component as loading and show the skeleton if no `user` is provided\n * @param fallback - Node to render inside the avatar fallback area before initials or the default icon\n * @returns The avatar element to render (JSX)\n */\nexport function UserAvatar({\n  className,\n  user,\n  isPending,\n  fallback,\n  ...config\n}: UserAvatarProps) {\n  const context = useAuth(config)\n\n  const { data: sessionData, isPending: sessionPending } = useSession(context)\n\n  if ((isPending || sessionPending) && !user) {\n    return <Skeleton className={cn(\"size-8 rounded-full\", className)} />\n  }\n\n  const resolvedUser = user ?? sessionData?.user\n\n  const initials = (\n    resolvedUser?.username ||\n    resolvedUser?.name ||\n    resolvedUser?.email\n  )\n    ?.slice(0, 2)\n    .toUpperCase()\n\n  return (\n    <Avatar\n      className={cn(\n        \"size-8 bg-muted text-foreground text-sm rounded-full\",\n        className\n      )}\n    >\n      <AvatarImage\n        src={resolvedUser?.image ?? undefined}\n        alt={\n          resolvedUser?.displayUsername ||\n          resolvedUser?.name ||\n          resolvedUser?.email\n        }\n      />\n\n      <AvatarFallback delayMs={resolvedUser?.image ? 600 : undefined}>\n        {fallback || initials || <User2 className=\"size-4\" />}\n      </AvatarFallback>\n    </Avatar>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/hooks/auth/use-auth.tsx",
      "content": "import {\n  type AnyAuthConfig,\n  type AuthConfig,\n  AuthContext\n} from \"@better-auth-ui/react\"\nimport { deepmerge, defaultConfig } from \"@better-auth-ui/react/core\"\nimport { useContext } from \"react\"\nimport { toast } from \"sonner\"\n\nconst extendConfig: AnyAuthConfig = {\n  toast,\n  Link: (props) => <a {...props} />\n}\n\n/**\n * Constructs the effective AuthConfig by merging defaults, any AuthContext-provided config, and the optional `config` overrides.\n *\n * @param config - Partial configuration overrides applied on top of context and defaults\n * @returns The final `AuthConfig` with a non-optional `authClient`\n * @throws If the resulting config does not include an `authClient`\n */\nexport function useAuth(config?: AnyAuthConfig) {\n  const context = useContext(AuthContext)\n\n  const authConfig = deepmerge(\n    deepmerge(defaultConfig as AnyAuthConfig, extendConfig),\n    deepmerge(context || {}, config || {})\n  ) as AuthConfig\n\n  if (authConfig.authClient === undefined) {\n    throw new Error(\"[Better Auth UI] authClient is required\")\n  }\n\n  return authConfig\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "src/hooks/auth/use-session.ts",
      "content": "export { useSession } from \"@better-auth-ui/react\"\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/auth/use-session.tsx",
      "content": "import type { AnyAuthConfig } from \"@better-auth-ui/react\"\nimport { type DefinedInitialDataOptions, useQuery } from \"@tanstack/react-query\"\n\nimport { useAuth } from \"../auth/use-auth\"\n\n/**\n * Fetches and returns the session data.\n *\n * @param config - Optional partial AuthConfig used to customize auth behavior; may include an `authClient` override.\n * @param options - Optional query options.\n * @returns Query result containing session data, loading state, and error state\n */\nexport function useSession(\n  config?: AnyAuthConfig,\n  options?: Partial<DefinedInitialDataOptions>\n) {\n  const { authClient, queryClient } = useAuth(config)\n\n  return useQuery(\n    {\n      queryKey: [\"auth\", \"session\"],\n      queryFn: () => authClient.getSession({ fetchOptions: { throw: true } }),\n      ...(options as object)\n    },\n    queryClient\n  )\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/settings/use-list-device-sessions.ts",
      "content": "import { type AnyAuthConfig, useSession } from \"@better-auth-ui/react\"\nimport { type DefinedInitialDataOptions, useQuery } from \"@tanstack/react-query\"\nimport { useAuth } from \"../auth/use-auth\"\n\n/**\n * Fetches and returns the list of device sessions for multi-session support.\n *\n * @param config - Optional partial AuthConfig used to customize auth behavior; may include an `authClient` override.\n * @param options - Optional query options.\n * @returns Query result containing device sessions data, loading state, and error state\n */\nexport function useListDeviceSessions(\n  config?: AnyAuthConfig,\n  options?: DefinedInitialDataOptions\n) {\n  const { authClient, multiSession, queryClient } = useAuth(config)\n  const { data: sessionData } = useSession(config, options)\n\n  return useQuery(\n    {\n      queryKey: [\n        \"auth\",\n        \"multiSession\",\n        \"listDeviceSessions\",\n        sessionData?.session.id\n      ],\n      queryFn: async () =>\n        authClient.multiSession.listDeviceSessions({\n          fetchOptions: { throw: true }\n        }),\n      enabled: multiSession && !!sessionData,\n      ...(options as object)\n    },\n    queryClient\n  )\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/settings/use-set-active-session.ts",
      "content": "import type { AnyAuthConfig } from \"@better-auth-ui/react\"\nimport { useCallback, useState } from \"react\"\n\nimport { useAuth } from \"../auth/use-auth\"\n\n/**\n * Provides functionality to set an active session from device sessions in multi-session mode.\n *\n * @param config - Optional auth configuration forwarded to the auth hook\n * @returns An object containing the pending session token and a function to set the active session\n */\nexport function useSetActiveSession(config?: AnyAuthConfig) {\n  const { authClient, queryClient, toast } = useAuth(config)\n\n  const [settingActiveSession, setSettingActiveSession] = useState<\n    string | null\n  >(null)\n\n  const setActiveSession = useCallback(\n    async (sessionToken: string) => {\n      setSettingActiveSession(sessionToken)\n\n      const { error } = await authClient.multiSession.setActive({\n        sessionToken\n      })\n\n      if (error) {\n        toast.error(error.message || error.statusText)\n      } else {\n        await queryClient.invalidateQueries({ queryKey: [\"auth\"] })\n      }\n\n      setSettingActiveSession(null)\n    },\n    [authClient, queryClient, toast]\n  )\n\n  return { settingActiveSession, setActiveSession }\n}\n",
      "type": "registry:hook"
    }
  ],
  "type": "registry:component"
}