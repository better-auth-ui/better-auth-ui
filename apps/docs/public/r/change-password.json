{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "change-password",
  "title": "Change Password",
  "description": "A form component for users to change their password with current password verification.",
  "dependencies": [
    "@better-auth-ui/react@*",
    "better-auth",
    "lucide-react"
  ],
  "registryDependencies": [
    "button",
    "card",
    "field",
    "input",
    "input-group",
    "skeleton",
    "spinner"
  ],
  "files": [
    {
      "path": "src/components/settings/security/change-password.tsx",
      "content": "\"use client\"\n\nimport { useAuth } from \"@better-auth-ui/react\"\nimport { Check, Eye, EyeOff } from \"lucide-react\"\nimport { useState } from \"react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Card,\n  CardContent,\n  CardFooter,\n  CardHeader,\n  CardTitle\n} from \"@/components/ui/card\"\nimport { Field, FieldError, FieldLabel } from \"@/components/ui/field\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupInput\n} from \"@/components/ui/input-group\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport { Spinner } from \"@/components/ui/spinner\"\nimport { useSession } from \"@/hooks/auth/use-session\"\nimport { useChangePassword } from \"@/hooks/settings/use-change-password\"\nimport { cn } from \"@/lib/utils\"\n\nexport type ChangePasswordProps = {\n  className?: string\n}\n\n/**\n * Display a form allowing the authenticated user to change their password.\n *\n * Renders a card containing fields for current password, new password, and\n * optionally password confirmation (based on emailAndPassword.confirmPassword config).\n * Upon successful submission, all other sessions are revoked for security.\n *\n * @returns A JSX element containing the change password card and form\n */\nexport function ChangePassword({ className }: ChangePasswordProps) {\n  const { emailAndPassword, localization } = useAuth()\n  const { data: sessionData } = useSession()\n  const [, formAction, isPending] = useChangePassword()\n\n  const [isNewPasswordVisible, setIsNewPasswordVisible] = useState(false)\n  const [isConfirmPasswordVisible, setIsConfirmPasswordVisible] =\n    useState(false)\n\n  const [fieldErrors, setFieldErrors] = useState<{\n    currentPassword?: string\n    newPassword?: string\n    confirmPassword?: string\n  }>({})\n\n  return (\n    <form action={formAction}>\n      <Card className={cn(\"w-full py-4 md:py-6 gap-4 md:gap-6\", className)}>\n        <CardHeader className=\"px-4 md:px-6 gap-0\">\n          <CardTitle className=\"text-xl\">\n            {localization.settings.changePassword}\n          </CardTitle>\n        </CardHeader>\n\n        <CardContent className=\"px-4 md:px-6 grid gap-4 md:gap-6\">\n          <Field className=\"gap-1\">\n            <FieldLabel htmlFor=\"currentPassword\">\n              {localization.settings.currentPassword}\n            </FieldLabel>\n\n            {sessionData ? (\n              <Input\n                id=\"currentPassword\"\n                name=\"currentPassword\"\n                type=\"password\"\n                autoComplete=\"current-password\"\n                placeholder={localization.settings.currentPasswordPlaceholder}\n                disabled={isPending}\n                required\n                onChange={() => {\n                  setFieldErrors((prev) => ({\n                    ...prev,\n                    currentPassword: undefined\n                  }))\n                }}\n                onInvalid={(e) => {\n                  e.preventDefault()\n                  setFieldErrors((prev) => ({\n                    ...prev,\n                    currentPassword: (e.target as HTMLInputElement)\n                      .validationMessage\n                  }))\n                }}\n                aria-invalid={!!fieldErrors.currentPassword}\n              />\n            ) : (\n              <Skeleton className=\"h-9 w-full\" />\n            )}\n\n            <FieldError>{fieldErrors.currentPassword}</FieldError>\n          </Field>\n\n          <Field className=\"gap-1\">\n            <FieldLabel htmlFor=\"newPassword\">\n              {localization.auth.newPassword}\n            </FieldLabel>\n\n            {sessionData ? (\n              <InputGroup>\n                <InputGroupInput\n                  id=\"newPassword\"\n                  name=\"newPassword\"\n                  type={isNewPasswordVisible ? \"text\" : \"password\"}\n                  autoComplete=\"new-password\"\n                  placeholder={localization.auth.newPasswordPlaceholder}\n                  minLength={emailAndPassword?.minPasswordLength}\n                  maxLength={emailAndPassword?.maxPasswordLength}\n                  disabled={isPending}\n                  required\n                  onChange={() => {\n                    setFieldErrors((prev) => ({\n                      ...prev,\n                      newPassword: undefined\n                    }))\n                  }}\n                  onInvalid={(e) => {\n                    e.preventDefault()\n                    setFieldErrors((prev) => ({\n                      ...prev,\n                      newPassword: (e.target as HTMLInputElement)\n                        .validationMessage\n                    }))\n                  }}\n                  aria-invalid={!!fieldErrors.newPassword}\n                />\n\n                <InputGroupAddon align=\"inline-end\">\n                  <InputGroupButton\n                    size=\"icon-xs\"\n                    aria-label={\n                      isNewPasswordVisible\n                        ? localization.auth.hidePassword\n                        : localization.auth.showPassword\n                    }\n                    onClick={() =>\n                      setIsNewPasswordVisible(!isNewPasswordVisible)\n                    }\n                    disabled={isPending}\n                  >\n                    {isNewPasswordVisible ? <EyeOff /> : <Eye />}\n                  </InputGroupButton>\n                </InputGroupAddon>\n              </InputGroup>\n            ) : (\n              <Skeleton className=\"h-9 w-full\" />\n            )}\n\n            <FieldError>{fieldErrors.newPassword}</FieldError>\n          </Field>\n\n          {emailAndPassword?.confirmPassword && (\n            <Field className=\"gap-1\">\n              <FieldLabel htmlFor=\"confirmPassword\">\n                {localization.auth.confirmPassword}\n              </FieldLabel>\n\n              {sessionData ? (\n                <InputGroup>\n                  <InputGroupInput\n                    id=\"confirmPassword\"\n                    name=\"confirmPassword\"\n                    type={isConfirmPasswordVisible ? \"text\" : \"password\"}\n                    autoComplete=\"new-password\"\n                    placeholder={localization.auth.confirmPasswordPlaceholder}\n                    minLength={emailAndPassword?.minPasswordLength}\n                    maxLength={emailAndPassword?.maxPasswordLength}\n                    disabled={isPending}\n                    required\n                    onChange={() => {\n                      setFieldErrors((prev) => ({\n                        ...prev,\n                        confirmPassword: undefined\n                      }))\n                    }}\n                    onInvalid={(e) => {\n                      e.preventDefault()\n                      setFieldErrors((prev) => ({\n                        ...prev,\n                        confirmPassword: (e.target as HTMLInputElement)\n                          .validationMessage\n                      }))\n                    }}\n                    aria-invalid={!!fieldErrors.confirmPassword}\n                  />\n\n                  <InputGroupAddon align=\"inline-end\">\n                    <InputGroupButton\n                      size=\"icon-xs\"\n                      aria-label={\n                        isConfirmPasswordVisible\n                          ? localization.auth.hidePassword\n                          : localization.auth.showPassword\n                      }\n                      onClick={() =>\n                        setIsConfirmPasswordVisible(!isConfirmPasswordVisible)\n                      }\n                      disabled={isPending}\n                    >\n                      {isConfirmPasswordVisible ? <EyeOff /> : <Eye />}\n                    </InputGroupButton>\n                  </InputGroupAddon>\n                </InputGroup>\n              ) : (\n                <Skeleton className=\"h-9 w-full\" />\n              )}\n\n              <FieldError>{fieldErrors.confirmPassword}</FieldError>\n            </Field>\n          )}\n        </CardContent>\n\n        <CardFooter className=\"px-4 md:px-6\">\n          <Button type=\"submit\" disabled={isPending || !sessionData}>\n            {isPending ? <Spinner /> : <Check />}\n\n            {localization.settings.updatePassword}\n          </Button>\n        </CardFooter>\n      </Card>\n    </form>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/hooks/auth/use-session.ts",
      "content": "export { useSession } from \"@better-auth-ui/react\"\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/auth/use-session.tsx",
      "content": "import { useAuth } from \"@better-auth-ui/react\"\nimport { type DefinedInitialDataOptions, useQuery } from \"@tanstack/react-query\"\n\n/**\n * Fetches and returns the session data.\n *\n * @param options - Optional query options.\n * @returns Query result containing session data, loading state, and error state\n */\nexport function useSession(options?: Partial<DefinedInitialDataOptions>) {\n  const { authClient } = useAuth()\n\n  return useQuery({\n    queryKey: [\"auth\", \"session\"],\n    queryFn: () => authClient.getSession({ fetchOptions: { throw: true } }),\n    ...(options as object)\n  })\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "src/hooks/settings/use-change-password.ts",
      "content": "export { useChangePassword } from \"@better-auth-ui/react\"\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/settings/use-change-password.ts",
      "content": "import { useAuth } from \"@better-auth-ui/react\"\nimport { useActionState } from \"react\"\n\n/**\n * Provides an action state hook that allows an authenticated user to change their password.\n *\n * @returns An action state whose action initiates the password change process and displays success or error toasts\n */\nexport function useChangePassword() {\n  const { authClient, emailAndPassword, localization, toast } = useAuth()\n\n  const changePassword = async (_: object, formData: FormData) => {\n    const currentPassword = formData.get(\"currentPassword\") as string\n    const newPassword = formData.get(\"newPassword\") as string\n    const confirmPassword = formData.get(\"confirmPassword\") as string\n\n    if (emailAndPassword?.confirmPassword && newPassword !== confirmPassword) {\n      toast.error(localization.auth.passwordsDoNotMatch)\n      return {}\n    }\n\n    const { error } = await authClient.changePassword({\n      currentPassword,\n      newPassword,\n      revokeOtherSessions: true\n    })\n\n    if (error) {\n      toast.error(error.message || error.statusText)\n    } else {\n      toast.success(localization.settings.changePasswordSuccess)\n    }\n\n    return {}\n  }\n\n  return useActionState(changePassword, {})\n}\n",
      "type": "registry:hook"
    }
  ],
  "type": "registry:component"
}